[醉月思的个人空间_哔哩哔哩_bilibili](https://space.bilibili.com/379064222)

[方舟完美内网穿透及跨物理机互通教程 - 哔哩哔哩 (bilibili.com)](https://www.bilibili.com/read/cv7908384/)

[Centos7安装与配置OpenVPN服务器_ITPUB博客](http://blog.itpub.net/69955379/viewspace-2789764/)

# OpenVPN安装

**更新  软件包**

```
yum -y update
```

虽然也是可以不进行更新直接安装。

**安装 OpenVPN 和 EasyRSA**

安装 OpenVPN、 Firewalld 软件包以及用于生成各种证书的 EasyRSA

```
yum -y install openvpn easy-rsa firewalld
```

如果未能成功安装 OpenVPN，则可能需要先安装一下 Epel 库。

```
yum install epel-release -y
```

**生成 CA 证书、服务端密钥与共享密钥**

这里步骤比较多。

**首先需要初始化 PKI**

```
cd ~
/usr/share/easy-rsa/3/easyrsa init-pki
```

**接下来是生成 CA 证书**

```
/usr/share/easy-rsa/3/easyrsa build-ca nopass
```

其中 nopass 表示不加密私钥，主要是方便后面导出公钥与颁发服务器证书。

**再来是生成交互密钥**

```
/usr/share/easy-rsa/3/easyrsa gen-dh
```

**开始生成服务端密钥**

```
/usr/share/easy-rsa/3/easyrsa build-server-full vpn-server nopass
```

**接下来生成客户端密钥，如果未开启同证书允许多人登陆，则需要多次执行生成对应的客户端密钥**

```
/usr/share/easy-rsa/3/easyrsa build-client-full vpn-client-01 nopass
```

**最后是生成证书交互列表，如果不需要 crl-verify 则可以跳过**

```
/usr/share/easy-rsa/3/easyrsa gen-crl
```

**其实到这一步需要的证书都以及生成好了，如果你开启了 tls-auth 则还需要生成共享密钥**

```
openvpn --genkey --secret pki/ta.key
```

**在上面所有证书都生成完毕之后，我们需要将相关证书拷贝到 OpenVPN 的配置文件夹中（似乎也可以在 conf 文件中使用绝对路径）**

```
cp pki/ca.crt /etc/openvpn/ca.crt
cp pki/dh.pem /etc/openvpn/dh.pem
cp pki/issued/vpn-server.crt /etc/openvpn/server.crt
cp pki/private/vpn-server.key /etc/openvpn/server.key
cp pki/ta.key /etc/openvpn/ta.key
cp pki/crl.pem /etc/openvpn/crl.pem
```

**配置服务端**

OpenVPN 配置文件有许多可定制化，具体请查阅官方文档。

```
cd /etc/openvpn
vim server.conf
```

将以下内容粘贴进去

```
# Secure OpenVPN Server Config
# Basic Connection Config
# 隧道模式，可选值为 tun 和 tap，服务器和客户端设置须为一致
dev tun
# 使用的协议，可选值为 udp 和 tcp
proto udp
# 监听地址
port 1194
keepalive 10 120
max-clients 10
# 证书路径
ca ca.crt
cert server.crt
key server.key
dh dh.pem
# tls 握手阶段使用的证书，其中第二个参数在服务器端值为 0，客户端值为 1
tls-auth ta.key 0
# Ciphers and Hardening
reneg-sec 0
remote-cert-tls client
crl-verify crl.pem
tls-version-min 1.2
cipher AES-256-CBC
auth SHA512
tls-cipher TLS-DHE-RSA-WITH-AES-256-GCM-SHA384:TLS-DHE-RSA-WITH-AES-256-CBC-SHA256:TLS-DHE-RSA-WITH-AES-128-GCM-SHA256:TLS-DHE-RSA-WITH-AES-128-CBC-SHA256
# Drop Privs
user nobody
group nobody
# IP 池配置，服务器将占用第一个 IP（10.8.0.1），需要注意的是，该网段不能和现有网段重复以免造成冲突
server 172.31.100.0 255.255.255.0
topology subnet
# 记录客户端的 IP 地址
ifconfig-pool-persist ipp.txt
client-config-dir client
# 客户端超时重连时使用之前的证书和隧道连接状态
persist-key
persist-tun
comp-lzo
# DHCP Push options force all traffic through VPN and sets DNS servers
push "redirect-gateway def1 bypass-dhcp"
push "dhcp-option DNS 8.8.8.8"
push "dhcp-option DNS 8.8.4.4"
# Logging
log-append /var/log/openvpn.log
verb 3
#sndbuf 393216
#rcvbuf 393216
```

启动服务端并让其开机自动启动

```
systemctl start openvpn@server
systemctl enable openvpn@server
```

**配置防火墙与流量转发**

**放行 OpenVPN 入网流量与开启 IP 伪装**

```
firewall-cmd --permanent --add-service openvpn
firewall-cmd --permanent --add-masquerade
firewall-cmd --reload
```

**检查是否开启流量转发**

```
sysctl -a | grep net.ipv4.ip_forward
```

**确保net.ipv4.ip_forward 等于 1，如果不是，则需要修改一下**

```
echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf
sysctl -p
```

**配置客户端**

**客户端需要拷贝以下文件**

```
cd ~
mkdir vpn-client-01-config
cp pki/ca.crt vpn-client-01-config/ca.crt
cp pki/issued/vpn-client-01.crt vpn-client-01-config/client.crt
cp pki/private/vpn-client-01.key vpn-client-01-config/client.key
cp pki/ta.key vpn-client-01-config/ta.key
```

**最后vim vpn-client-01-config/client.ovpn并粘贴下面内容**

```
# Secure OpenVPN Client Config
#viscosity dns full
#viscosity usepeerdns true
#viscosity dhcp true
tls-client
pull
client
dev tun
proto udp
remote 150.158.1.170 1194
redirect-gateway def1
nobind
persist-key
persist-tun
comp-lzo
verb 3
ca ca.crt
cert client.crt
key client.key
tls-auth ta.key 1
remote-cert-tls server
ns-cert-type server
key-direction 1
cipher AES-256-GCM
tls-version-min 1.2
auth SHA512
tls-cipher TLS-DHE-RSA-WITH-AES-256-GCM-SHA384:TLS-DHE-RSA-WITH-AES-256-CBC-SHA256:TLS-DHE-RSA-WITH-AES-128-GCM-SHA256:TLS-DHE-RSA-WITH-AES-128-CBC-SHA256
```

remote后面填写服务端IP地址和使用的端口号，然后将 vpn-client-01-config 的所有文件拷贝到需要链接的电脑上，即可开始使用。

另一套配置：

```bash
server
# 监听地址
local 0.0.0.0
# 监听的端口，默认是1194
port 1194
# 使用的协议，可选值为 udp 和 tcp
proto tcp
# 隧道模式，可选值为 tun 和 tap，服务器和客户端设置须为一致
dev tun
# 证书路径
ca ca.crt
cert server.crt
key server.key
dh dh.pem
# tls 握手阶段使用的证书，其中第二个参数在服务器端值为 0，客户端值为 1
tls-auth ta.key 0
# IP 池配置，服务器将占用第一个 IP（10.8.0.1），需要注意的是，该网段不能和现有网段重复以免造成冲突
server 172.31.100.0 255.255.255.0
# 记录客户端的 IP 地址
ifconfig-pool-persist ipp.txt
# 允许客户端之前互相可以访问
# client-to-client
# 允许同一个用户从多个设备同时登录
# duplicate-cn
# 心跳检测，每 10 秒检测一次，120 秒连接超时
keepalive 10 120
# 密码格式
cipher AES-256-CBC
# 压缩算法
compress lz4-v2
push "compress lz4-v2"
# 客户端并发连接数
max-clients 10
# 客户端超时重连时使用之前的证书和隧道连接状态
persist-key
persist-tun
# 记录连接信息文件
status openvpn-status.log
# 日志记录方式，以下选项二选一，如果都不选，则将日志写入 rsyslog
# 以覆盖方式写入指定文件
;log openvpn.log
# 以追加方式写入指定文件
;log-append openvpn.log
# 日志记录等级，0：静默，只记录严重错误；4：合理的普通信息；5、6：可以用来调试连接上遇到的问题；9：啰嗦模式
verb 3
# 设置最多输出连续 20 条的相同信息
;mute 20
# 通知客户端服务器端重启完毕以便重连，仅用于 udp 模式下
explicit-exit-notify 1
```

```bash
# 说明该配置是客户端
client
# 使用 tun 隧道，必须与服务器端保持一致
dev tun
# 使用协议，必须与服务器端保持一致
proto tcp
# 服务器 IP 地址和端口
remote 129.226.215.151 1194
# 解析服务器地址次数，设置为无限则表示每次连接时均重新解析
resolv-retry infinite
# 不绑定端口
nobind
# 超时重连时使用之前的证书和隧道连接状态
persist-key
persist-tun
# 证书所在路径
ca ca.crt
cert dev.crt
key dev.key
tls-auth ta.key 1
# 远端证书通过服务器验证
remote-cert-tls server
# 密码格式，必须与服务器端保持一致
cipher AES-256-CBC
# 压缩算法，必须与服务器端保持一致
compress lz4-v2
# 日志记录等级，0：静默，只记录严重错误；4：合理的普通信息；5、6：可以用来调试连接上遇到的问题；9：啰嗦模式
verb 3
```

查看宝塔面板端口

```
/etc/init.d/bt default
```

查看端口占用

```
netstat -anlpt
```

[利用FRP和Openvpn实现内网穿透外网访问 | abcdocker运维博客 (i4t.com)](https://i4t.com/4961.html)

 firewall-cmd --list-all

查看网卡信息

```
ip addr
```

看路由表

```
route -n
```

重启防火墙

`firewall-cmd --complete-reload` 

sndbuf 393216

rcvbuf 393216

```
在系统 system1 设定端口转发，要求：

1、在172.24.8.0/24网络中的系统，访问system1的本地端口 5423 将被转发到 80

2、此设置必须永久有效

**答：**

# 配置转发端口

firewall-cmd --permanent --zone=public --add-rich-rule 'rule family="ipv4" source address="172.24.8.0/24" forward-port port="5423" protocol="tcp" to-port="80"'

# 生效配置

firewall-cmd --reload
```

把图中的push "redirect-gateway def1 bypass-dhcp"的注释去掉（这里重要，不开启的话，怎么配NAT都不会生效的）

```
网络环境：
**公网服务器    ：eth0:公网IP  eth1:内网IP - 192.168.1.1
[mysql](http://lib.csdn.net/base/mysql)服务器：eth1:内网IP - 192.168.1.2**
实现方法：通过访问公网IP的63306端口来实现到内网MYSQL服务器的3306端口的访问
在公网服务器上：
查询：iptables -L -n -t nat
配置脚本：
POSTROUTING:
iptables -t nat -A POSTROUTING -d 172.31.100.2 -p udp --dport 1024:65535 -j SNAT --to 172.31.100.1;
iptables -t nat -A POSTROUTING -d 172.31.100.2 -p tcp --dport 1024:65535 -j SNAT --to 172.31.100.1;
PREROUTING:
iptables -t nat -A PREROUTING -p udp --dport 10001 -j DNAT --to-destination 172.31.100.2:10001;
iptables -t nat -A PREROUTING -p udp --dport 10002 -j DNAT --to-destination 172.31.100.2:10002;
iptables -t nat -A PREROUTING -p udp --dport 10003 -j DNAT --to-destination 172.31.100.2:10003;
iptables -t nat -A PREROUTING -p udp --dport 10004 -j DNAT --to-destination 172.31.100.2:10004;
iptables -t nat -A PREROUTING -p udp --dport 10005 -j DNAT --to-destination 172.31.100.2:10005;
iptables -t nat -A PREROUTING -p udp --dport 10006 -j DNAT --to-destination 172.31.100.2:10006;
iptables -t nat -A PREROUTING -p udp --dport 10007 -j DNAT --to-destination 172.31.100.2:10007;
iptables -t nat -A PREROUTING -p udp --dport 10008 -j DNAT --to-destination 172.31.100.2:10008;
iptables -t nat -A PREROUTING -p udp --dport 10009 -j DNAT --to-destination 172.31.100.2:10009;
iptables -t nat -A PREROUTING -p udp --dport 10010 -j DNAT --to-destination 172.31.100.2:10010;
iptables -t nat -A PREROUTING -p udp --dport 10011 -j DNAT --to-destination 172.31.100.2:10011;
iptables -t nat -A PREROUTING -p udp --dport 10012 -j DNAT --to-destination 172.31.100.2:10012;
iptables -t nat -A PREROUTING -p udp --dport 10013 -j DNAT --to-destination 172.31.100.2:10013;
iptables -t nat -A PREROUTING -p udp --dport 10014 -j DNAT --to-destination 172.31.100.2:10014;
iptables -t nat -A PREROUTING -p udp --dport 10015 -j DNAT --to-destination 172.31.100.2:10015;
iptables -t nat -A PREROUTING -p udp --dport 10016 -j DNAT --to-destination 172.31.100.2:10016;
iptables -t nat -A PREROUTING -p udp --dport 10017 -j DNAT --to-destination 172.31.100.2:10017;
iptables -t nat -A PREROUTING -p udp --dport 10018 -j DNAT --to-destination 172.31.100.2:10018;
iptables -t nat -A PREROUTING -p udp --dport 10019 -j DNAT --to-destination 172.31.100.2:10019;
iptables -t nat -A PREROUTING -p udp --dport 10020 -j DNAT --to-destination 172.31.100.2:10020;
iptables -t nat -A PREROUTING -p udp --dport 10021 -j DNAT --to-destination 172.31.100.2:10021;
iptables -t nat -A PREROUTING -p udp --dport 10022 -j DNAT --to-destination 172.31.100.2:10022;
iptables -t nat -A PREROUTING -p udp --dport 10023 -j DNAT --to-destination 172.31.100.2:10023;
iptables -t nat -A PREROUTING -p udp --dport 10024 -j DNAT --to-destination 172.31.100.2:10024;
iptables -t nat -A PREROUTING -p udp --dport 10025 -j DNAT --to-destination 172.31.100.2:10025;
iptables -t nat -A PREROUTING -p udp --dport 10026 -j DNAT --to-destination 172.31.100.2:10026;
iptables -t nat -A PREROUTING -p udp --dport 10027 -j DNAT --to-destination 172.31.100.2:10027;
iptables -t nat -A PREROUTING -p udp --dport 10028 -j DNAT --to-destination 172.31.100.2:10028;
iptables -t nat -A PREROUTING -p udp --dport 10029 -j DNAT --to-destination 172.31.100.2:10029;
iptables -t nat -A PREROUTING -p udp --dport 10030 -j DNAT --to-destination 172.31.100.2:10030;
iptables -t nat -A PREROUTING -p udp --dport 10031 -j DNAT --to-destination 172.31.100.2:10031;
iptables -t nat -A PREROUTING -p udp --dport 10032 -j DNAT --to-destination 172.31.100.2:10032;
iptables -t nat -A PREROUTING -p udp --dport 10033 -j DNAT --to-destination 172.31.100.2:10033;
iptables -t nat -A PREROUTING -p udp --dport 10034 -j DNAT --to-destination 172.31.100.2:10034;
iptables -t nat -A PREROUTING -p udp --dport 10035 -j DNAT --to-destination 172.31.100.2:10035;
iptables -t nat -A PREROUTING -p udp --dport 10036 -j DNAT --to-destination 172.31.100.2:10036;
iptables -t nat -A PREROUTING -p udp --dport 10037 -j DNAT --to-destination 172.31.100.2:10037;
iptables -t nat -A PREROUTING -p udp --dport 10038 -j DNAT --to-destination 172.31.100.2:10038;
iptables -t nat -A PREROUTING -p udp --dport 10039 -j DNAT --to-destination 172.31.100.2:10039;
iptables -t nat -A PREROUTING -p udp --dport 10040 -j DNAT --to-destination 172.31.100.2:10040;
iptables -t nat -A PREROUTING -p udp --dport 10041 -j DNAT --to-destination 172.31.100.2:10041;
iptables -t nat -A PREROUTING -p udp --dport 10042 -j DNAT --to-destination 172.31.100.2:10042;
iptables -t nat -A PREROUTING -p udp --dport 10043 -j DNAT --to-destination 172.31.100.2:10043;
iptables -t nat -A PREROUTING -p udp --dport 10044 -j DNAT --to-destination 172.31.100.2:10044;
iptables -t nat -A PREROUTING -p udp --dport 10045 -j DNAT --to-destination 172.31.100.2:10045;
iptables -t nat -A PREROUTING -p udp --dport 10046 -j DNAT --to-destination 172.31.100.2:10046;
iptables -t nat -A PREROUTING -p udp --dport 10047 -j DNAT --to-destination 172.31.100.2:10047;
iptables -t nat -A PREROUTING -p udp --dport 10048 -j DNAT --to-destination 172.31.100.2:10048;
iptables -t nat -A PREROUTING -p udp --dport 10049 -j DNAT --to-destination 172.31.100.2:10049;
iptables -t nat -A PREROUTING -p udp --dport 10050 -j DNAT --to-destination 172.31.100.2:10050;
iptables -t nat -A PREROUTING -p udp --dport 10051 -j DNAT --to-destination 172.31.100.2:10051;
iptables -t nat -A PREROUTING -p udp --dport 10052 -j DNAT --to-destination 172.31.100.2:10052;
iptables -t nat -A PREROUTING -p udp --dport 10053 -j DNAT --to-destination 172.31.100.2:10053;
iptables -t nat -A PREROUTING -p udp --dport 10054 -j DNAT --to-destination 172.31.100.2:10054;
iptables -t nat -A PREROUTING -p udp --dport 10055 -j DNAT --to-destination 172.31.100.2:10055;
iptables -t nat -A PREROUTING -p udp --dport 10056 -j DNAT --to-destination 172.31.100.2:10056;
iptables -t nat -A PREROUTING -p udp --dport 10057 -j DNAT --to-destination 172.31.100.2:10057;
iptables -t nat -A PREROUTING -p udp --dport 10058 -j DNAT --to-destination 172.31.100.2:10058;
iptables -t nat -A PREROUTING -p udp --dport 10059 -j DNAT --to-destination 172.31.100.2:10059;
iptables -t nat -A PREROUTING -p udp --dport 10060 -j DNAT --to-destination 172.31.100.2:10060;
iptables -t nat -A PREROUTING -p udp --dport 10061 -j DNAT --to-destination 172.31.100.2:10061;
iptables -t nat -A PREROUTING -p udp --dport 10062 -j DNAT --to-destination 172.31.100.2:10062;
iptables -t nat -A PREROUTING -p udp --dport 10063 -j DNAT --to-destination 172.31.100.2:10063;
iptables -t nat -A PREROUTING -p udp --dport 10064 -j DNAT --to-destination 172.31.100.2:10064;
iptables -t nat -A PREROUTING -p udp --dport 10065 -j DNAT --to-destination 172.31.100.2:10065;
iptables -t nat -A PREROUTING -p udp --dport 10066 -j DNAT --to-destination 172.31.100.2:10066;
iptables -t nat -A PREROUTING -p udp --dport 10067 -j DNAT --to-destination 172.31.100.2:10067;
iptables -t nat -A PREROUTING -p udp --dport 10068 -j DNAT --to-destination 172.31.100.2:10068;
iptables -t nat -A PREROUTING -p udp --dport 10069 -j DNAT --to-destination 172.31.100.2:10069;
iptables -t nat -A PREROUTING -p udp --dport 10070 -j DNAT --to-destination 172.31.100.2:10070;
iptables -t nat -A PREROUTING -p udp --dport 10071 -j DNAT --to-destination 172.31.100.2:10071;
iptables -t nat -A PREROUTING -p udp --dport 10072 -j DNAT --to-destination 172.31.100.2:10072;
iptables -t nat -A PREROUTING -p udp --dport 10073 -j DNAT --to-destination 172.31.100.2:10073;
iptables -t nat -A PREROUTING -p udp --dport 10074 -j DNAT --to-destination 172.31.100.2:10074;
iptables -t nat -A PREROUTING -p udp --dport 10075 -j DNAT --to-destination 172.31.100.2:10075;
iptables -t nat -A PREROUTING -p udp --dport 10076 -j DNAT --to-destination 172.31.100.2:10076;
iptables -t nat -A PREROUTING -p udp --dport 10077 -j DNAT --to-destination 172.31.100.2:10077;
iptables -t nat -A PREROUTING -p udp --dport 10078 -j DNAT --to-destination 172.31.100.2:10078;
iptables -t nat -A PREROUTING -p udp --dport 10079 -j DNAT --to-destination 172.31.100.2:10079;
iptables -t nat -A PREROUTING -p udp --dport 10080 -j DNAT --to-destination 172.31.100.2:10080;
iptables -t nat -A PREROUTING -p udp --dport 10081 -j DNAT --to-destination 172.31.100.2:10081;
iptables -t nat -A PREROUTING -p udp --dport 10082 -j DNAT --to-destination 172.31.100.2:10082;
iptables -t nat -A PREROUTING -p udp --dport 10083 -j DNAT --to-destination 172.31.100.2:10083;
iptables -t nat -A PREROUTING -p udp --dport 10084 -j DNAT --to-destination 172.31.100.2:10084;
iptables -t nat -A PREROUTING -p udp --dport 10085 -j DNAT --to-destination 172.31.100.2:10085;
iptables -t nat -A PREROUTING -p udp --dport 10086 -j DNAT --to-destination 172.31.100.2:10086;
iptables -t nat -A PREROUTING -p udp --dport 10087 -j DNAT --to-destination 172.31.100.2:10087;
iptables -t nat -A PREROUTING -p udp --dport 10088 -j DNAT --to-destination 172.31.100.2:10088;
iptables -t nat -A PREROUTING -p udp --dport 10089 -j DNAT --to-destination 172.31.100.2:10089;
iptables -t nat -A PREROUTING -p udp --dport 10090 -j DNAT --to-destination 172.31.100.2:10090;
iptables -t nat -A PREROUTING -p udp --dport 10091 -j DNAT --to-destination 172.31.100.2:10091;
iptables -t nat -A PREROUTING -p udp --dport 10092 -j DNAT --to-destination 172.31.100.2:10092;
iptables -t nat -A PREROUTING -p udp --dport 10093 -j DNAT --to-destination 172.31.100.2:10093;
iptables -t nat -A PREROUTING -p udp --dport 10094 -j DNAT --to-destination 172.31.100.2:10094;
iptables -t nat -A PREROUTING -p udp --dport 10095 -j DNAT --to-destination 172.31.100.2:10095;
iptables -t nat -A PREROUTING -p udp --dport 10096 -j DNAT --to-destination 172.31.100.2:10096;
iptables -t nat -A PREROUTING -p udp --dport 10097 -j DNAT --to-destination 172.31.100.2:10097;
iptables -t nat -A PREROUTING -p udp --dport 10098 -j DNAT --to-destination 172.31.100.2:10098;
iptables -t nat -A PREROUTING -p udp --dport 10099 -j DNAT --to-destination 172.31.100.2:10099;
iptables -t nat -A PREROUTING -p tcp --dport 10099 -j DNAT --to-destination 172.31.100.2:10099;
iptables -t nat -A PREROUTING -p udp --dport 10100 -j DNAT --to-destination 172.31.100.2:10100;
iptables -t nat -A PREROUTING -p tcp --dport 10100 -j DNAT --to-destination 172.31.100.2:10100;

10001-10056：服务器端口：
	10001-10004：仙境测试；
	10005-10008：孤岛测试；
	
	10053-10056：正版服引流。
	
1099：游戏群聊天互通
10100：QE商店助手
1226-1229：小灰灰机器人接收端下面是灰灰机器人配置：
iptables -t nat -A PREROUTING -p udp --dport 1226 -j DNAT --to-destination 172.31.100.2:1226;
iptables -t nat -A PREROUTING -p tcp --dport 1226 -j DNAT --to-destination 172.31.100.2:1226;
iptables -t nat -A PREROUTING -p udp --dport 1227 -j DNAT --to-destination 172.31.100.2:1227;
iptables -t nat -A PREROUTING -p tcp --dport 1227 -j DNAT --to-destination 172.31.100.2:1227;
iptables -t nat -A PREROUTING -p udp --dport 1228 -j DNAT --to-destination 172.31.100.2:1228;
iptables -t nat -A PREROUTING -p tcp --dport 1228 -j DNAT --to-destination 172.31.100.2:1228;
iptables -t nat -A PREROUTING -p udp --dport 1229 -j DNAT --to-destination 172.31.100.2:1229;
iptables -t nat -A PREROUTING -p tcp --dport 1229 -j DNAT --to-destination 172.31.100.2:1229;
iptables -t nat -A PREROUTING -p tcp --dport 10057 -j DNAT --to-destination 172.31.100.2:10057;
iptables -t nat -A PREROUTING -p tcp --dport 10058 -j DNAT --to-destination 172.31.100.2:10058;
iptables -t nat -A PREROUTING -p tcp --dport 10059 -j DNAT --to-destination 172.31.100.2:10059;
iptables -t nat -A PREROUTING -p tcp --dport 10060 -j DNAT --to-destination 172.31.100.2:10060;
iptables -t nat -A PREROUTING -p tcp --dport 10061 -j DNAT --to-destination 172.31.100.2:10061;
iptables -t nat -A PREROUTING -p tcp --dport 10062 -j DNAT --to-destination 172.31.100.2:10062;
iptables -t nat -A PREROUTING -p tcp --dport 10063 -j DNAT --to-destination 172.31.100.2:10063;
iptables -t nat -A PREROUTING -p tcp --dport 10064 -j DNAT --to-destination 172.31.100.2:10064;
iptables -t nat -A PREROUTING -p tcp --dport 10065 -j DNAT --to-destination 172.31.100.2:10065;
iptables -t nat -A PREROUTING -p tcp --dport 10066 -j DNAT --to-destination 172.31.100.2:10066;
iptables -t nat -A PREROUTING -p tcp --dport 10067 -j DNAT --to-destination 172.31.100.2:10067;
iptables -t nat -A PREROUTING -p tcp --dport 10068 -j DNAT --to-destination 172.31.100.2:10068;
iptables -t nat -A PREROUTING -p tcp --dport 10069 -j DNAT --to-destination 172.31.100.2:10069;
iptables -t nat -A PREROUTING -p tcp --dport 10070 -j DNAT --to-destination 172.31.100.2:10070;


上面到10100了
iptables -t nat -A PREROUTING -p udp --dport 10801 -j DNAT --to-destination 172.31.100.2:10801
iptables -t nat -A POSTROUTING -d 172.31.100.2 -p udp --dport 10801 -j SNAT --to 172.31.100.1

查看nat表
iptables --list PREROUTING -t nat
iptables --list POSTROUTING -t nat
允许服务器的IP转发功能：
echo 1 > /proc/sys/net/ipv4/ip_forward

保存规则：#iptables-save >/etc/sysconfig/iptables
恢复规则：#iptables-restore>/etc/sysconfig/iptables
使用方法：
mysql -h 公网IP -p 63306 -uroot -p
```

https://blog.csdn.net/xzknet/article/details/51957269

[(1条消息) Centos7 Firewall 防火墙配置规则_自由的大月-CSDN博客_firewall删除规则](https://blog.csdn.net/iflow/article/details/79535456)

　　systemctl stop firewalld.service

　　systemctl disable firewalld.service

保存规则：#iptables-save >/etc/sysconfig/iptables
恢复规则：#iptables-restore>/etc/sysconfig/iptables
