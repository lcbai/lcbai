# 服务器搭建青龙和阿东短信登录并安装依赖

服务器：Centos7.7

本教程收集于2021年11.9日

## 1. 安装docker并设置开机自启

```javascript
sudo yum check-update
curl -sSL https://get.daocloud.io/docker | sh
sudo systemctl start docker
sudo systemctl status docker
sudo systemctl enable docker 
```

## 2. 用pip安装docker-compose

```javascript
yum -y install python3-pip
pip3 install --upgrade pip
pip3 install docker-compose
```

## 4. 创建`docker-compose.yml`

```javascript
mkdir jd-qinglong
cd jd-qinglong
touch docker-compose.yml
```

## 5. 在`docker-compose.yml`中填入：

**阿东（端口自己改）：**

```javascript
version: '3.3'
services:
    jd-qinglong:
        container_name: jd-login
        image: rubyangxg/jd-qinglong:1.7
        ports:
            - 888:8080
        privileged: true
        volumes:
            - ./env.properties:/env.properties:ro
            - ./go-cqhttp:/go-cqhttp
```

**青龙（端口自己改）：**

    version: '3.3'
    services:
        qinglong:
            container_name: ql
            image: whyour/qinglong:latest
            ports:
                - 8888:5700
            environment:
                - ENABLE_HANGUP=true
                - ENABLE_WEB_PANEL=true
            volumes:
                - /root/ql/config:/ql/config
                - /root/ql/log:/ql/log
                - /root/ql/db:/ql/db
                - /root/ql/repo:/ql/repo
                - /root/ql/raw:/ql/raw
                - /root/ql/scripts:/ql/scripts
                - /root/ql/jbot:/ql/jbot
            restart: always
            labels:
                - com.centurylinklabs.watchtower.enable=false

## 6. 启动 

需要cd进`docker-compose.yml`目录 ，`-d`表示后台静默启动

```
docker-compose up -d  
```

查看运行日志

```
docker-compose logs -f
```

## 7. 青龙互助（一行命令）

```
rm -rf /root/ql/config/config.sh &&   rm -rf /root/ql/config/task_before.sh &&  cd ql/config &&  wget  https://womc.cn/jdc/config.sh && wget https://womc.cn/jdc/task_before.sh  && cd  &&  cd ql/scripts &&  wget  https://womc.cn/jdc/code.sh
```

然后添加互助码定时任务

![image-20211109201146745](https://gitee.com/linchang98/document/raw/markdown-picture/2021/202111092011781.png)

## 8. 青龙安装依赖(最新的青龙2.10可以在面板直接装)

首先进入你要安装的容器

```javascript
docker exec -it ql bash # ql为容器名根据自己容器修改
```

```javascript
package_name="canvas png-js date-fns axios crypto-js ts-md5 tslib @types/node dotenv typescript fs require tslib"

for i in $package_name; do
    case $i in
        canvas)
            cd /ql/scripts
            npm install $i
            ;;
        *)
            npm install $i -g
            ;;
    esac
done
```

```
yarn add jsdom
```

